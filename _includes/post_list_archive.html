<ul class="archive">
    {% for post in page.posts reversed %}
        {% capture old_month %}{{ previous_post.date | date:"%m" }}{% endcapture %}
        {% capture month %}{{ post.date | date:"%m" }}{% endcapture %}
        {% capture old_year %}{{ previous_post.date | date:"%Y" }}{% endcapture %}
        {% capture year %}{{ post.date | date:"%Y" }}{% endcapture %}
        {% if old_month != month %}
            {% if old_year != year %}
                <div class="year">{{ post.date | date:"%Y" }}</div>
            {% endif %}
            <div class="month">{{ post.date | date:"%B" }}</div>
        {% endif %}
        <li><span class="day">{{ post.date | date:"%d" }}</span> <a href="{{ post.url }}">{{ post.title }}</a></li>
        {% assign previous_post = post %}
    {% endfor %}
</ul>